<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>MSCS 264: Data Science 2 - Web scraping in R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">MSCS 264: Data Science 2</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-tech-notes" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Tech Notes</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-tech-notes">    
        <li>
    <a class="dropdown-item" href="./tech_setup.html" rel="" target="">
 <span class="dropdown-text">Tech Setup</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./why_quarto.html" rel="" target="">
 <span class="dropdown-text">Why Quarto?</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./github_website.html" rel="" target="">
 <span class="dropdown-text">Using GitHub</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./github_links.html" rel="" target="">
 <span class="dropdown-text">GitHub Links</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-activities" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Activities</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-activities">    
        <li>
    <a class="dropdown-item" href="./01_review164.html" rel="" target="">
 <span class="dropdown-text">Review of Data Science 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./02_maps_part1.html" rel="" target="">
 <span class="dropdown-text">Creating informative maps</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03_maps_part2.html" rel="" target="">
 <span class="dropdown-text">Working with geospatial data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./04_functions.html" rel="" target="">
 <span class="dropdown-text">Functions and tidy evaluation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./05_data_types.html" rel="" target="">
 <span class="dropdown-text">Data types</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./06_iteration.html" rel="" target="">
 <span class="dropdown-text">Iteration</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./07_simulation.html" rel="" target="">
 <span class="dropdown-text">Simulation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./MDSR_Ch13_simulation.html" rel="" target="">
 <span class="dropdown-text">MDSR Ch 13: Simulation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./08_strings_part1.html" rel="" target="">
 <span class="dropdown-text">Strings: Pre-class Video</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./09_strings_part2.html" rel="" target="">
 <span class="dropdown-text">Strings: In-class Exercises</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./10_strings_part3.html" rel="" target="">
 <span class="dropdown-text">Strings: Extra Practice</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./11_SQL.html" rel="" target="">
 <span class="dropdown-text">MDSR Ch 15: Database querying using SQL</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./12_webscraping.html" rel="" target="">
 <span class="dropdown-text">Web scraping in R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./13_first_shiny_instructions.html" rel="" target="">
 <span class="dropdown-text">First Shiny instructions</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-projects" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Projects</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-projects">    
        <li>
    <a class="dropdown-item" href="./miniproject1.html" rel="" target="">
 <span class="dropdown-text">Mini-Project 1: Maps</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./miniproject2.html" rel="" target="">
 <span class="dropdown-text">Mini-Project 2: Simulation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./miniproject3.html" rel="" target="">
 <span class="dropdown-text">Mini-Project 3: Strings and Regular Expressions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./miniproject4.html" rel="" target="">
 <span class="dropdown-text">Mini-Project 4: SQL</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./finalproject.html" rel="" target="">
 <span class="dropdown-text">Final Project: Shiny App</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="./rtipoftheday.html" rel="" target="">
 <span class="menu-text">R Tip of the Day</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./12_webscraping.html">Web scraping in R</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_review164.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Review of Data Science 1</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_maps_part1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Creating informative maps</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_maps_part2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Working with geospatial data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Functions and tidy evaluation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_data_types.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data types</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_iteration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Iteration</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07_simulation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Simulation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MDSR_Ch13_simulation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">MDSR Ch 13: Simulation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08_strings_part1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Strings: Pre-class Video</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09_strings_part2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Strings: In-class Exercises</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10_strings_part3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Strings: Extra Practice</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11_SQL.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">MDSR Ch 15: Database querying using SQL</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12_webscraping.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Web scraping in R</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13_first_shiny_instructions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">First Shiny instructions</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#getting-data-from-websites" id="toc-getting-data-from-websites" class="nav-link active" data-scroll-target="#getting-data-from-websites">Getting data from websites</a></li>
  <li><a href="#option-1-apis" id="toc-option-1-apis" class="nav-link" data-scroll-target="#option-1-apis">Option 1: APIs</a></li>
  <li><a href="#option-2-rvest-for-web-scraping" id="toc-option-2-rvest-for-web-scraping" class="nav-link" data-scroll-target="#option-2-rvest-for-web-scraping">Option 2: rvest for web scraping</a>
  <ul class="collapse">
  <li><a href="#there-are-typically-four-steps-to-scraping-data-with-functions-in-the-rvest-library" id="toc-there-are-typically-four-steps-to-scraping-data-with-functions-in-the-rvest-library" class="nav-link" data-scroll-target="#there-are-typically-four-steps-to-scraping-data-with-functions-in-the-rvest-library">There are typically four steps to scraping data with functions in the <code>rvest</code> library:</a></li>
  <li><a href="#when-the-data-is-already-in-table-form" id="toc-when-the-data-is-already-in-table-form" class="nav-link" data-scroll-target="#when-the-data-is-already-in-table-form">When the data is already in table form:</a></li>
  <li><a href="#when-the-data-are-not-a-table" id="toc-when-the-data-are-not-a-table" class="nav-link" data-scroll-target="#when-the-data-are-not-a-table">When the data are NOT a table</a>
  <ul class="collapse">
  <li><a href="#pipe-it" id="toc-pipe-it" class="nav-link" data-scroll-target="#pipe-it">pipe it!</a></li>
  </ul></li>
  <li><a href="#another-option-fyi-but-honestly-this-is-harder" id="toc-another-option-fyi-but-honestly-this-is-harder" class="nav-link" data-scroll-target="#another-option-fyi-but-honestly-this-is-harder">Another option, FYI, but honestly this is harder:</a></li>
  <li><a href="#putting-multiple-columns-of-data-together." id="toc-putting-multiple-columns-of-data-together." class="nav-link" data-scroll-target="#putting-multiple-columns-of-data-together.">Putting multiple columns of data together.</a>
  <ul class="collapse">
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises">Exercises</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Web scraping in R</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>You can download this .qmd file from <a href="https://github.com/proback/264_fall_2024/blob/main/12_webscraping.qmd">here</a>. Just hit the Download Raw File button.</p>
<section id="getting-data-from-websites" class="level2">
<h2 class="anchored" data-anchor-id="getting-data-from-websites">Getting data from websites</h2>
</section>
<section id="option-1-apis" class="level1">
<h1>Option 1: APIs</h1>
<p>APIs are Application Programming Interfaces, instructions for how programs should interact with your software. For our purposes of obtaining data, APIs exist where website developers make data nicely packaged for consumption. The language HTTP (hypertext transfer protocol) underlies APIs, and the R package <code>httr()</code> was written to map closely to HTTP with R.</p>
<p>Essentially you send a request to the website (server) where you want data from, and they send a response, which should contain the data (plus other stuff).</p>
<p>This is a really quick introduction, just to get you started and show you what’s possible. For more information, these links can be somewhat helpful:</p>
<ul>
<li>https://cran.r-project.org/web/packages/httr/vignettes/quickstart.html</li>
<li>https://towardsdatascience.com/functions-with-r-and-rvest-a-laymens-guide-acda42325a77</li>
<li>https://www.analyticsvidhya.com/blog/2017/03/beginners-guide-on-web-scraping-in-r-using-rvest-with-hands-on-knowledge/</li>
<li>https://nceas.github.io/oss-lessons/data-liberation/intro-webscraping.html</li>
</ul>
<p>Plus this website with a list of public APIs:</p>
<ul>
<li>https://github.com/toddmotto/public-apis</li>
</ul>
<p>There are also many R packages that provide a set of functions to communicate with a particular API, such as: ZillowR, rtweet, genius, Rspotify, tidycensus, etc.</p>
<p>Here’s an example of getting data from a website that attempts to make imdb movie data available as an API.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>myapikey <span class="ot">&lt;-</span> <span class="st">"YOUR API KEY"</span>  <span class="co"># enter your API key for omdbapi.com </span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># (must obtain personal key)</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># default is JSON = JavaScript Object Notation, </span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">#  which is standard data format for APIs</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># - URL obtained by searching for Coco in 2017 at omdbapi.com</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># - this part is optional: plot=short&amp;r=json&amp;</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="st">"http://www.omdbapi.com/?t=Coco&amp;y=2017&amp;apikey="</span>, myapikey)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>coco <span class="ot">&lt;-</span> <span class="fu">GET</span>(url)   <span class="co"># coco holds response from server</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>coco               <span class="co"># Status of 200 is good!</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>details <span class="ot">&lt;-</span> <span class="fu">content</span>(coco, <span class="st">"parse"</span>)   </span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>details                             <span class="co"># get a list of 25 pieces of information</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>details<span class="sc">$</span>Year                        <span class="co"># how to access details</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>details[[<span class="dv">2</span>]]                        <span class="co"># since a list, another way to access</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Build a data set for a set of movies</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Must figure out pattern in URL for obtaining different movies</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">#  - try searching for others</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>movies <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Coco"</span>, <span class="st">"Wonder+Woman"</span>, <span class="st">"Get+Out"</span>, </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">"The+Greatest+Showman"</span>, <span class="st">"Thor:+Ragnarok"</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up empty tibble</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>omdb <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">Title =</span> <span class="fu">character</span>(), <span class="at">Rated =</span> <span class="fu">character</span>(), <span class="at">Genre =</span> <span class="fu">character</span>(),</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">Actors =</span> <span class="fu">character</span>(), <span class="at">Metascore =</span> <span class="fu">double</span>(), <span class="at">imdbRating =</span> <span class="fu">double</span>(),</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">BoxOffice =</span> <span class="fu">double</span>())</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Use for loop to run through API request process 5 times,</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co">#   each time filling the next row in the tibble</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co">#  - can do max of 1000 GETs per day</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) {</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  url <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="st">"http://www.omdbapi.com/?t="</span>,movies[i],</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>               <span class="st">"&amp;apikey="</span>, myapikey)</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  onemovie <span class="ot">&lt;-</span> <span class="fu">GET</span>(url)</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  details <span class="ot">&lt;-</span> <span class="fu">content</span>(onemovie, <span class="st">"parse"</span>)</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  omdb[i,<span class="dv">1</span>] <span class="ot">&lt;-</span> details<span class="sc">$</span>Title</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  omdb[i,<span class="dv">2</span>] <span class="ot">&lt;-</span> details<span class="sc">$</span>Rated</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  omdb[i,<span class="dv">3</span>] <span class="ot">&lt;-</span> details<span class="sc">$</span>Genre</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  omdb[i,<span class="dv">4</span>] <span class="ot">&lt;-</span> details<span class="sc">$</span>Actors</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  omdb[i,<span class="dv">5</span>] <span class="ot">&lt;-</span> <span class="fu">parse_number</span>(details<span class="sc">$</span>Metascore)</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>  omdb[i,<span class="dv">6</span>] <span class="ot">&lt;-</span> <span class="fu">parse_number</span>(details<span class="sc">$</span>imdbRating)</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>  omdb[i,<span class="dv">7</span>] <span class="ot">&lt;-</span> <span class="fu">parse_number</span>(details<span class="sc">$</span>BoxOffice)   <span class="co"># no $ and ,'s</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>omdb</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Here's what the resulting tibble looks like:</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 5 x 7</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a><span class="do">##   Title    Rated Genre      Actors          Metascore imdbRating BoxOffice</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a><span class="do">## * &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;               &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 Coco     PG    Animation… Anthony Gonzal…        81        8.4 208487719</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 Wonder … PG-13 Action, A… Gal Gadot, Chr…        76        7.5 412400625</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 Get Out  R     Horror, M… Daniel Kaluuya…        84        7.7 175428355</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 The Gre… PG    Biography… Hugh Jackman, …        48        7.7 164616443</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a><span class="do">## 5 Thor: R… PG-13 Action, A… Chris Hemswort…        74        7.9 314971245</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a><span class="co">#  could use stringr functions to further organize this data - separate </span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a><span class="co">#    different genres, different actors, etc.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="option-2-rvest-for-web-scraping" class="level1">
<h1>Option 2: rvest for web scraping</h1>
<p>If you would like to assemble data from a website with no API, you can often acquire data using more brute force methods commonly called web scraping. Typically, this involves finding content inside HTML (Hypertext markup language) code used for creating webpages and web applications and the CSS (Cascading style sheets) language for customizing the appearance of webpages. We are used to reading data from .csv files…. but most websites have it stored in XML (like html, but for data). You can read more about it here if you’re interested: https://www.w3schools.com/xml/default.asp</p>
<p>XML has a sort of tree or graph-like structure… so we can identify information by which <code>node</code> it belongs to (<code>html_nodes</code>) and then convert the content into something we can use in R (<code>html_text</code> or <code>html_table</code>).</p>
<section id="there-are-typically-four-steps-to-scraping-data-with-functions-in-the-rvest-library" class="level2">
<h2 class="anchored" data-anchor-id="there-are-typically-four-steps-to-scraping-data-with-functions-in-the-rvest-library">There are typically four steps to scraping data with functions in the <code>rvest</code> library:</h2>
<ol start="0" type="1">
<li><code>robots_text::paths_allowed()</code> Check if the website allows scraping!</li>
<li><code>read_html()</code>. Input the URL containing the data and turn the html code into an XML file (another markup format that’s easier to work with).</li>
<li><code>html_nodes()</code>. Extract specific nodes from the XML file by using the CSS path that leads to the content of interest. (use css=“table” for tables.)</li>
<li><code>html_text()</code>. Extract content of interest from nodes. Might also use <code>html_table()</code> etc.</li>
</ol>
<p>The CSS selector used in <code>html_nodes()</code> was derived using <em>SelectorGadget</em> (go to selectorgadget.com to install in your browser). You might also consider the fun CSS Selector tutorial at http://flukeout.github.io/.</p>
<p>Before scraping, we should always check first whether the website allows scraping. We should also consider if there’s any personal or confidential information, and we should be considerate to not overload the server we’re scraping from.</p>
<p>See here for an interesting example: https://techcrunch.com/2021/06/14/supreme-court-revives-linkedin-bid-to-protect-user-data-from-web-scrapers/</p>
</section>
<section id="when-the-data-is-already-in-table-form" class="level2">
<h2 class="anchored" data-anchor-id="when-the-data-is-already-in-table-form">When the data is already in table form:</h2>
<p>In this example, we will scrape climate data from this website: https://www.usclimatedata.com/climate/minneapolis/minnesota/united-states/usmn0503</p>
<p>The website already contains data in table form, so we use <code>html_nodes(. , css = "table")</code> and <code>html_table()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># checkout the website below first</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>robotstxt<span class="sc">::</span><span class="fu">paths_allowed</span>(<span class="st">"https://www.usclimatedata.com/climate/minneapolis/minnesota/united-states/usmn0503"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
 www.usclimatedata.com                      </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1: read_html()</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>mpls <span class="ot">&lt;-</span> <span class="fu">read_html</span>(<span class="st">"https://www.usclimatedata.com/climate/minneapolis/minnesota/united-states/usmn0503"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Use the option <code>css = "table"</code> within html_nodes()</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2: html_nodes()</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>tables <span class="ot">&lt;-</span> <span class="fu">html_nodes</span>(mpls, <span class="at">css =</span> <span class="st">"table"</span>) </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>tables  <span class="co"># have to guesstimate which table contains climate info</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{xml_nodeset (8)}
[1] &lt;table id="monthly_table_one" class="table table-hover tablesaw tablesaw- ...
[2] &lt;table id="monthly_table_two" class="table table-hover tablesaw tablesaw- ...
[3] &lt;table class="table table-hover tablesaw tablesaw-mode-swipe mt-4 daily_t ...
[4] &lt;table class="table table-hover tablesaw tablesaw-mode-swipe mt-4 history ...
[5] &lt;table class="table table-striped table-hover tablesaw tablesaw-mode-swip ...
[6] &lt;table class="table table-hover tablesaw geo_table"&gt;\n&lt;thead&gt;&lt;tr&gt;\n&lt;th&gt;&nbsp;&lt; ...
[7] &lt;table class="table table-hover tablesaw datetime_table" data-tablesaw-hi ...
[8] &lt;table class="table table-hover tablesaw monthly_summary_table" data-tabl ...</code></pre>
</div>
</div>
<p>Use html_table() rather than html_text()</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 3: html_table()</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">html_table</span>(tables, <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">fill =</span> <span class="cn">TRUE</span>)    <span class="co"># find the right table</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
# A tibble: 6 × 7
  ``                                    JanJa  FebFe  MarMa  AprAp  MayMa  JunJu
  &lt;chr&gt;                                 &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
1 Average high in ºF Av. high Hi         24    29     41     58     69     79   
2 Average low in ºF Av. low Lo            8    13     24     37     49     59   
3 Days with precipitation Days precip.…   8     7     11      9     11     13   
4 Hours of sunshine Hours sun. Sun      140   166    200    231    272    302   
5 Av. precipitation in inch Av. precip…   0.9   0.77   1.89   2.66   3.36   4.25
6 Av. snowfall in inch Snowfall Sn       12     8     10      3      0      0   

[[2]]
# A tibble: 6 × 7
  ``                                     JulJu AugAu  SepSe  OctOc  NovNo  DecDe
  &lt;chr&gt;                                  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
1 Average high in ºF Av. high Hi         83     80    72     58     41     27   
2 Average low in ºF Av. low Lo           64     62    52     40     26     12   
3 Days with precipitation Days precip.…  10     10     9      8      8      8   
4 Hours of sunshine Hours sun. Sun      343    296   237    193    115    112   
5 Av. precipitation in inch Av. precip…   4.04   4.3   3.08   2.43   1.77   1.16
6 Av. snowfall in inch Snowfall Sn        0      0     0      1      9     12   

[[3]]
# A tibble: 31 × 7
   Day    HighºF LowºF `Prec/moinch` `Prec/yrinch` `Snow/moinch` `Snow/yrinch`
   &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;         &lt;dbl&gt;         &lt;dbl&gt;         &lt;dbl&gt;         &lt;dbl&gt;
 1 1 Jan    23.8   8.3          0.04          0.04          0.39           1  
 2 2 Jan    23.7   8.2          0.08          0.08          0.71           1.8
 3 3 Jan    23.6   8.1          0.12          0.12          1.1            2.8
 4 4 Jan    23.5   7.9          0.12          0.12          1.5            3.8
 5 5 Jan    23.5   7.8          0.16          0.16          1.81           4.6
 6 6 Jan    23.4   7.7          0.2           0.2           2.2            5.6
 7 7 Jan    23.4   7.6          0.24          0.24          2.6            6.6
 8 8 Jan    23.3   7.5          0.28          0.28          3.11           7.9
 9 9 Jan    23.3   7.4          0.28          0.28          3.5            8.9
10 10 Jan   23.3   7.3          0.31          0.31          3.9            9.9
# ℹ 21 more rows

[[4]]
# A tibble: 26 × 6
   Day    HighºF LowºF Precip.inch Snowinch `Snow d.inch`
   &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;            &lt;dbl&gt;
 1 01 Dec   32    19   0.07        1.61                 7
 2 02 Dec   27    12   0.00        0.00                 6
 3 03 Dec   37.9  19.9 0.00        0.00                 6
 4 04 Dec   39    24.1 0.00        0.00                 6
 5 05 Dec   37    21.9 0.00        0.00                 5
 6 06 Dec   32    17.1 0.00        0.00                 5
 7 07 Dec   42.1  21.9 0.00        0.00                 5
 8 08 Dec   41    30.9 0.00        0.00                 5
 9 09 Dec   34    -0.9 0.16        2.52                 5
10 10 Dec    8.1  -4   T           T                    7
# ℹ 16 more rows

[[5]]
# A tibble: 9 × 4
  ``                                          `Dec 19`    ``    Normal     
  &lt;chr&gt;                                       &lt;chr&gt;       &lt;lgl&gt; &lt;chr&gt;      
1 "Average high temperature Av. high temp."   "29.9 ºF"   NA    "27 ºF"    
2 "Average low temperature Av. low temp."     "14.6 ºF"   NA    "12 ºF"    
3 "Total precipitation Total precip."         "0.39 inch" NA    "1.16 inch"
4 "Total snowfall Total snowfall"             "6.33 inch" NA    "12 inch"  
5 ""                                          ""          NA    ""         
6 "Highest max temperature Highest max temp." "44.1 ºF"   NA    "-"        
7 "Lowest max temperature Lowest max temp."   "8.1 ºF"    NA    "-"        
8 "Highest min temperature Highest min temp." "32.0 ºF"   NA    "-"        
9 "Lowest min temperature Lowest min temp."   "-5.1 ºF"   NA    "-"        

[[6]]
# A tibble: 10 × 3
   ``                   ``                ``   
   &lt;chr&gt;                &lt;chr&gt;             &lt;lgl&gt;
 1 Country              United States     NA   
 2 State                Minnesota         NA   
 3 County               Hennepin          NA   
 4 City                 Minneapolis       NA   
 5 Zip code             55401             NA   
 6 Longitude            -93.27 dec. degr. NA   
 7 Latitude             44.98 dec. degr.  NA   
 8 Altitude - Elevation 840ft             NA   
 9 ICAO                 -                 NA   
10 IATA                 -                 NA   

[[7]]
# A tibble: 6 × 3
  ``          ``              ``   
  &lt;chr&gt;       &lt;chr&gt;           &lt;lgl&gt;
1 Local Time  11:54 PM        NA   
2 Sunrise     05:53 AM        NA   
3 Sunset      08:25 PM        NA   
4 Day / Night Night           NA   
5 Timezone    Chicago -6:00   NA   
6 Timezone DB America/Chicago NA   

[[8]]
# A tibble: 6 × 2
  ``                         ``        
  &lt;chr&gt;                      &lt;chr&gt;     
1 Annual high temperature    55ºF      
2 Annual low temperature     37ºF      
3 Days per year with precip. 112 days  
4 Annual hours of sunshine   2607 hours
5 Average annual precip.     30.61 inch
6 Av. annual snowfall        55 inch   </code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>mpls_data1 <span class="ot">&lt;-</span> <span class="fu">html_table</span>(tables, <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">fill =</span> <span class="cn">TRUE</span>)[[<span class="dv">1</span>]]  </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>mpls_data1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 7
  ``                                    JanJa  FebFe  MarMa  AprAp  MayMa  JunJu
  &lt;chr&gt;                                 &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
1 Average high in ºF Av. high Hi         24    29     41     58     69     79   
2 Average low in ºF Av. low Lo            8    13     24     37     49     59   
3 Days with precipitation Days precip.…   8     7     11      9     11     13   
4 Hours of sunshine Hours sun. Sun      140   166    200    231    272    302   
5 Av. precipitation in inch Av. precip…   0.9   0.77   1.89   2.66   3.36   4.25
6 Av. snowfall in inch Snowfall Sn       12     8     10      3      0      0   </code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>mpls_data2 <span class="ot">&lt;-</span> <span class="fu">html_table</span>(tables, <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">fill =</span> <span class="cn">TRUE</span>)[[<span class="dv">2</span>]]  </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>mpls_data2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 7
  ``                                     JulJu AugAu  SepSe  OctOc  NovNo  DecDe
  &lt;chr&gt;                                  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
1 Average high in ºF Av. high Hi         83     80    72     58     41     27   
2 Average low in ºF Av. low Lo           64     62    52     40     26     12   
3 Days with precipitation Days precip.…  10     10     9      8      8      8   
4 Hours of sunshine Hours sun. Sun      343    296   237    193    115    112   
5 Av. precipitation in inch Av. precip…   4.04   4.3   3.08   2.43   1.77   1.16
6 Av. snowfall in inch Snowfall Sn        0      0     0      1      9     12   </code></pre>
</div>
</div>
<p>Even after finding the correct tables, there may still be a lot of work to make it tidy!!! What is each line of code doing below?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_cols</span>(mpls_data1, mpls_data2) <span class="sc">|&gt;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="st">`</span><span class="at">...8</span><span class="st">`</span>) <span class="sc">|&gt;</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">...1</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">str_extract</span>(<span class="st">`</span><span class="at">...1</span><span class="st">`</span>, <span class="st">"[^ ]+ [^ ]+ [^ ]+"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">JanJa</span><span class="st">`</span><span class="sc">:</span><span class="st">`</span><span class="at">DecDe</span><span class="st">`</span>), </span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"month"</span>, <span class="at">values_to =</span> <span class="st">"weather"</span>) <span class="sc">|&gt;</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">`</span><span class="at">...1</span><span class="st">`</span>, <span class="at">values_from =</span> weather) <span class="sc">|&gt;</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">str_sub</span>(month, <span class="dv">1</span>, <span class="dv">3</span>))  <span class="sc">|&gt;</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">avg_high =</span> <span class="st">"Average high in"</span>,</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">avg_low =</span> <span class="st">"Average low in"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>New names:
• `` -&gt; `...1`
• `` -&gt; `...8`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 7
   month avg_high avg_low `Days with precipitation` `Hours of sunshine`
   &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt;                     &lt;dbl&gt;               &lt;dbl&gt;
 1 Jan         24       8                         8                 140
 2 Feb         29      13                         7                 166
 3 Mar         41      24                        11                 200
 4 Apr         58      37                         9                 231
 5 May         69      49                        11                 272
 6 Jun         79      59                        13                 302
 7 Jul         83      64                        10                 343
 8 Aug         80      62                        10                 296
 9 Sep         72      52                         9                 237
10 Oct         58      40                         8                 193
11 Nov         41      26                         8                 115
12 Dec         27      12                         8                 112
# ℹ 2 more variables: `Av. precipitation in` &lt;dbl&gt;, `Av. snowfall in` &lt;dbl&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Probably want to rename the rest of the variables too!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="when-the-data-are-not-a-table" class="level2">
<h2 class="anchored" data-anchor-id="when-the-data-are-not-a-table">When the data are NOT a table</h2>
<p>In this example, we scrape the cast of the movie Coco from IMDb: https://www.imdb.com/title/tt2380307/</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Verfiy site allows scraping</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>robotstxt<span class="sc">::</span><span class="fu">paths_allowed</span>(<span class="st">"https://www.imdb.com/title/tt2380307/"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
 www.imdb.com                      </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check if tables works first! </span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">read_html</span>(<span class="st">"https://www.imdb.com/title/tt2380307/"</span>, <span class="at">css =</span> <span class="st">"table"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_table</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>list()</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Download the HTML and turn it into an XML file with read_html()</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co">#     - look at Coco page on imdb</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>coco <span class="ot">&lt;-</span> <span class="fu">read_html</span>(<span class="st">"https://www.imdb.com/title/tt2380307/"</span>)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Extract specific nodes with html_nodes()</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   - finding exact node (e.g. .dGCmsL) is the tricky part.  </span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co">#     Among all the html code used to produce a webpage, where do you </span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="co">#     go to grab the content of interest?</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="co"># One solution: selectorGadget (bookmark version; Chrome extension flukey)</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>cast <span class="ot">&lt;-</span> <span class="fu">html_nodes</span>(coco, <span class="st">".gCQkeh"</span>)</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>cast</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{xml_nodeset (18)}
 [1] &lt;a data-testid="title-cast-item__actor" href="/name/nm5645519/?ref_=tt_c ...
 [2] &lt;a data-testid="title-cast-item__actor" href="/name/nm0305558/?ref_=tt_c ...
 [3] &lt;a data-testid="title-cast-item__actor" href="/name/nm0000973/?ref_=tt_c ...
 [4] &lt;a data-testid="title-cast-item__actor" href="/name/nm0005513/?ref_=tt_c ...
 [5] &lt;a data-testid="title-cast-item__actor" href="/name/nm0896149/?ref_=tt_c ...
 [6] &lt;a data-testid="title-cast-item__actor" href="/name/nm0131781/?ref_=tt_c ...
 [7] &lt;a data-testid="title-cast-item__actor" href="/name/nm0000778/?ref_=tt_c ...
 [8] &lt;a data-testid="title-cast-item__actor" href="/name/nm0797567/?ref_=tt_c ...
 [9] &lt;a data-testid="title-cast-item__actor" href="/name/nm0407101/?ref_=tt_c ...
[10] &lt;a data-testid="title-cast-item__actor" href="/name/nm0101603/?ref_=tt_c ...
[11] &lt;a data-testid="title-cast-item__actor" href="/name/nm0613872/?ref_=tt_c ...
[12] &lt;a data-testid="title-cast-item__actor" href="/name/nm3086285/?ref_=tt_c ...
[13] &lt;a data-testid="title-cast-item__actor" href="/name/nm0526090/?ref_=tt_c ...
[14] &lt;a data-testid="title-cast-item__actor" href="/name/nm0001579/?ref_=tt_c ...
[15] &lt;a data-testid="title-cast-item__actor" href="/name/nm2016172/?ref_=tt_c ...
[16] &lt;a data-testid="title-cast-item__actor" href="/name/nm3770662/?ref_=tt_c ...
[17] &lt;a data-testid="title-cast-item__actor" href="/name/nm0650969/?ref_=tt_c ...
[18] &lt;a data-testid="title-cast-item__actor" href="/name/nm0883609/?ref_=tt_c ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Extract content from nodes with html_text(), html_name(), </span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co">#    html_attrs(), html_children(), html_table()</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Usually will still need to do some stringr adjustments</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="fu">html_text</span>(cast)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Anthony Gonzalez"        "Gael García Bernal"     
 [3] "Benjamin Bratt"          "Alanna Ubach"           
 [5] "Renee Victor"            "Jaime Camil"            
 [7] "Alfonso Arau"            "Herbert Siguenza"       
 [9] "Gabriel Iglesias"        "Lombardo Boyar"         
[11] "Ana Ofelia Murguía"      "Natalia Cordova-Buckley"
[13] "Selene Luna"             "Edward James Olmos"     
[15] "Sofía Espinosa"          "Carla Medina"           
[17] "Dyana Ortelli"           "Luis Valdez"            </code></pre>
</div>
</div>
<section id="pipe-it" class="level3">
<h3 class="anchored" data-anchor-id="pipe-it">pipe it!</h3>
<p>You can also write this altogether with a pipe:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>robotstxt<span class="sc">::</span><span class="fu">paths_allowed</span>(<span class="st">"https://www.imdb.com/title/tt2380307/"</span>)   <span class="co">#DON'T FORGET!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
 www.imdb.com                      </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read_html</span>(<span class="st">"https://www.imdb.com/title/tt2380307/"</span>) <span class="sc">|&gt;</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="st">".gCQkeh"</span>) <span class="sc">|&gt;</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Anthony Gonzalez"        "Gael García Bernal"     
 [3] "Benjamin Bratt"          "Alanna Ubach"           
 [5] "Renee Victor"            "Jaime Camil"            
 [7] "Alfonso Arau"            "Herbert Siguenza"       
 [9] "Gabriel Iglesias"        "Lombardo Boyar"         
[11] "Ana Ofelia Murguía"      "Natalia Cordova-Buckley"
[13] "Selene Luna"             "Edward James Olmos"     
[15] "Sofía Espinosa"          "Carla Medina"           
[17] "Dyana Ortelli"           "Luis Valdez"            </code></pre>
</div>
</div>
</section>
</section>
<section id="another-option-fyi-but-honestly-this-is-harder" class="level2">
<h2 class="anchored" data-anchor-id="another-option-fyi-but-honestly-this-is-harder">Another option, FYI, but honestly this is harder:</h2>
<p><em>Developer Tools</em> in your browser (under … &gt; More Tools) can also be used to locate the desired content among the hierarchy of HTML tags, as in cast2. Click on the arrow in the upper left, then click on the desired content in the webpage. An element of html code will be highlighted in the Developer Tools; right click on this element and Copy &gt; XPath, which can finally be pasted into html_nodes() in your R script. Likely quite a bit of cleaning will still need to be done.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Developer Tools</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="co"># cast2fail &lt;- html_nodes(coco, xpath = '//*[@id="titleCast"]/table/tbody/tr[2]/td[2]/a')</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>coco <span class="sc">|&gt;</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="at">xpath =</span> <span class="st">'//*[@id="__next"]/main/div/section[1]/div/section/div/div[1]/section[4]/div[2]/div[2]/div[1]/div[2]'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Anthony GonzalezMiguel(voice)"</code></pre>
</div>
</div>
</section>
<section id="putting-multiple-columns-of-data-together." class="level2">
<h2 class="anchored" data-anchor-id="putting-multiple-columns-of-data-together.">Putting multiple columns of data together.</h2>
<p>Use the <code>rvest</code> package to pull off data from imdb’s top grossing films released in 2017 at https://www.imdb.com/search/title?year=2017&amp;title_type=feature&amp;sort=boxoffice_gross_us,desc</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span><span class="st">"https://www.imdb.com/search/title?year=2017&amp;title_type=feature&amp;sort=boxoffice_gross_us,desc"</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>robotstxt<span class="sc">::</span><span class="fu">paths_allowed</span>(url)   <span class="co">#DON'T FORGET!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
 www.imdb.com                      </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>title <span class="ot">&lt;-</span> <span class="fu">read_html</span>(url) <span class="sc">|&gt;</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="st">".ipc-title-link-wrapper .ipc-title__text"</span>) <span class="sc">|&gt;</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text</span>()</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>content_rating <span class="ot">&lt;-</span> <span class="fu">read_html</span>(url) <span class="sc">|&gt;</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="st">".dli-title-metadata-item:nth-child(3)"</span>) <span class="sc">|&gt;</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text</span>()</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>description <span class="ot">&lt;-</span> <span class="fu">read_html</span>(url) <span class="sc">|&gt;</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="st">".ipc-html-content-inner-div"</span>) <span class="sc">|&gt;</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text</span>() <span class="sc">|&gt;</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_trim</span>()</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a><span class="co"># use tibble() to put multiple columns together into a tibble</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>movies2017 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(title, content_rating, description) <span class="sc">|&gt;</span> </span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="dv">2017</span>)</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>movies2017</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 50 × 4
   title                                      content_rating description    year
   &lt;chr&gt;                                      &lt;chr&gt;          &lt;chr&gt;         &lt;dbl&gt;
 1 1. Star Wars: Episode VIII - The Last Jedi PG-13          Rey develops…  2017
 2 2. Beauty and the Beast                    PG             A selfish Pr…  2017
 3 3. Wonder Woman                            PG-13          When a pilot…  2017
 4 4. Jumanji: Welcome to the Jungle          PG-13          Four teenage…  2017
 5 5. Guardians of the Galaxy Vol. 2          PG-13          The Guardian…  2017
 6 6. Spider-Man: Homecoming                  PG-13          Peter Parker…  2017
 7 7. It                                      R              In the summe…  2017
 8 8. Thor: Ragnarok                          PG-13          Imprisoned o…  2017
 9 9. Despicable Me 3                         PG             Gru meets hi…  2017
10 10. Justice League                         PG-13          Fueled by hi…  2017
# ℹ 40 more rows</code></pre>
</div>
</div>
<p>I can just update the url to get another year!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span><span class="st">"https://www.imdb.com/search/title?year=2018&amp;title_type=feature&amp;sort=boxoffice_gross_us,desc"</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>robotstxt<span class="sc">::</span><span class="fu">paths_allowed</span>(url)   <span class="co">#DON'T FORGET!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
 www.imdb.com                      </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>title <span class="ot">&lt;-</span> <span class="fu">read_html</span>(url) <span class="sc">|&gt;</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="st">".ipc-title-link-wrapper .ipc-title__text"</span>) <span class="sc">|&gt;</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text</span>()</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>content_rating <span class="ot">&lt;-</span> <span class="fu">read_html</span>(url) <span class="sc">|&gt;</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="st">".dli-title-metadata-item:nth-child(3)"</span>) <span class="sc">|&gt;</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text</span>()</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>description <span class="ot">&lt;-</span> <span class="fu">read_html</span>(url) <span class="sc">|&gt;</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="st">".ipc-html-content-inner-div"</span>) <span class="sc">|&gt;</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text</span>() <span class="sc">|&gt;</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_trim</span>()</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(title, content_rating, description)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 50 × 3
   title                             content_rating description                 
   &lt;chr&gt;                             &lt;chr&gt;          &lt;chr&gt;                       
 1 1. Black Panther                  PG-13          T'Challa, heir to the hidde…
 2 2. Avengers: Infinity War         PG-13          The Avengers and their alli…
 3 3. Incredibles 2                  PG             The Incredibles family take…
 4 4. Jurassic World: Fallen Kingdom PG-13          When the island's dormant v…
 5 5. Aquaman                        PG-13          Arthur Curry, the human-bor…
 6 6. Deadpool 2                     R              Foul-mouthed mutant mercena…
 7 7. The Grinch                     PG             A grumpy Grinch plots to ru…
 8 8. Mission: Impossible - Fallout  PG-13          Ethan Hunt and his IMF team…
 9 9. Ant-Man and the Wasp           PG-13          As Scott Lang balances bein…
10 10. Bohemian Rhapsody             PG-13          The story of the legendary …
# ℹ 40 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>movies2018 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(title, content_rating, description) <span class="sc">|&gt;</span> </span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="dv">2018</span>)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>movies2018</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 50 × 4
   title                             content_rating description             year
   &lt;chr&gt;                             &lt;chr&gt;          &lt;chr&gt;                  &lt;dbl&gt;
 1 1. Black Panther                  PG-13          T'Challa, heir to the…  2018
 2 2. Avengers: Infinity War         PG-13          The Avengers and thei…  2018
 3 3. Incredibles 2                  PG             The Incredibles famil…  2018
 4 4. Jurassic World: Fallen Kingdom PG-13          When the island's dor…  2018
 5 5. Aquaman                        PG-13          Arthur Curry, the hum…  2018
 6 6. Deadpool 2                     R              Foul-mouthed mutant m…  2018
 7 7. The Grinch                     PG             A grumpy Grinch plots…  2018
 8 8. Mission: Impossible - Fallout  PG-13          Ethan Hunt and his IM…  2018
 9 9. Ant-Man and the Wasp           PG-13          As Scott Lang balance…  2018
10 10. Bohemian Rhapsody             PG-13          The story of the lege…  2018
# ℹ 40 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(movies2017, movies2018)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 100 × 4
   title                                      content_rating description    year
   &lt;chr&gt;                                      &lt;chr&gt;          &lt;chr&gt;         &lt;dbl&gt;
 1 1. Star Wars: Episode VIII - The Last Jedi PG-13          Rey develops…  2017
 2 2. Beauty and the Beast                    PG             A selfish Pr…  2017
 3 3. Wonder Woman                            PG-13          When a pilot…  2017
 4 4. Jumanji: Welcome to the Jungle          PG-13          Four teenage…  2017
 5 5. Guardians of the Galaxy Vol. 2          PG-13          The Guardian…  2017
 6 6. Spider-Man: Homecoming                  PG-13          Peter Parker…  2017
 7 7. It                                      R              In the summe…  2017
 8 8. Thor: Ragnarok                          PG-13          Imprisoned o…  2017
 9 9. Despicable Me 3                         PG             Gru meets hi…  2017
10 10. Justice League                         PG-13          Fueled by hi…  2017
# ℹ 90 more rows</code></pre>
</div>
</div>
<p>which means… I can write a function to scrape multiple years!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>scrape_moviedata <span class="ot">&lt;-</span> <span class="cf">function</span>(year){</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  url <span class="ot">&lt;-</span><span class="fu">str_c</span>(<span class="st">"https://www.imdb.com/search/title?year="</span>, year, <span class="st">"&amp;title_type=feature&amp;sort=boxoffice_gross_us,desc"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span>robotstxt<span class="sc">::</span><span class="fu">paths_allowed</span>(url)){<span class="fu">stop</span>(<span class="st">"no scraping allowed!"</span>)}  </span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>title <span class="ot">&lt;-</span> <span class="fu">read_html</span>(url) <span class="sc">|&gt;</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="st">".ipc-title-link-wrapper .ipc-title__text"</span>) <span class="sc">|&gt;</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text</span>()</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>content_rating <span class="ot">&lt;-</span> <span class="fu">read_html</span>(url) <span class="sc">|&gt;</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="st">".dli-title-metadata-item:nth-child(3)"</span>) <span class="sc">|&gt;</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text</span>()</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>description <span class="ot">&lt;-</span> <span class="fu">read_html</span>(url) <span class="sc">|&gt;</span></span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="st">".ipc-html-content-inner-div"</span>) <span class="sc">|&gt;</span></span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text</span>() <span class="sc">|&gt;</span></span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_trim</span>()</span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(title, content_rating, description) <span class="sc">|&gt;</span> </span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> year)</span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a><span class="fu">scrape_moviedata</span>(<span class="dv">2017</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
 www.imdb.com                      </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 50 × 4
   title                                      content_rating description    year
   &lt;chr&gt;                                      &lt;chr&gt;          &lt;chr&gt;         &lt;dbl&gt;
 1 1. Star Wars: Episode VIII - The Last Jedi PG-13          Rey develops…  2017
 2 2. Beauty and the Beast                    PG             A selfish Pr…  2017
 3 3. Wonder Woman                            PG-13          When a pilot…  2017
 4 4. Jumanji: Welcome to the Jungle          PG-13          Four teenage…  2017
 5 5. Guardians of the Galaxy Vol. 2          PG-13          The Guardian…  2017
 6 6. Spider-Man: Homecoming                  PG-13          Peter Parker…  2017
 7 7. It                                      R              In the summe…  2017
 8 8. Thor: Ragnarok                          PG-13          Imprisoned o…  2017
 9 9. Despicable Me 3                         PG             Gru meets hi…  2017
10 10. Justice League                         PG-13          Fueled by hi…  2017
# ℹ 40 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>moviedata <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(<span class="fu">scrape_moviedata</span>(<span class="dv">2017</span>),</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>          <span class="fu">scrape_moviedata</span>(<span class="dv">2018</span>),</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>          <span class="fu">scrape_moviedata</span>(<span class="dv">2019</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
 www.imdb.com                      


 www.imdb.com                      


 www.imdb.com                      </code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>moviedata</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 150 × 4
   title                                      content_rating description    year
   &lt;chr&gt;                                      &lt;chr&gt;          &lt;chr&gt;         &lt;dbl&gt;
 1 1. Star Wars: Episode VIII - The Last Jedi PG-13          Rey develops…  2017
 2 2. Beauty and the Beast                    PG             A selfish Pr…  2017
 3 3. Wonder Woman                            PG-13          When a pilot…  2017
 4 4. Jumanji: Welcome to the Jungle          PG-13          Four teenage…  2017
 5 5. Guardians of the Galaxy Vol. 2          PG-13          The Guardian…  2017
 6 6. Spider-Man: Homecoming                  PG-13          Peter Parker…  2017
 7 7. It                                      R              In the summe…  2017
 8 8. Thor: Ragnarok                          PG-13          Imprisoned o…  2017
 9 9. Despicable Me 3                         PG             Gru meets hi…  2017
10 10. Justice League                         PG-13          Fueled by hi…  2017
# ℹ 140 more rows</code></pre>
</div>
</div>
<p>Be careful about problems in 2020…</p>
<p>It looks like a lot of films did not report a gross revenue in 2020, probably because of the weirdness of the pandemic:</p>
<p>2020 films sorted by popularity: https://www.imdb.com/search/title/?title_type=feature&amp;year=2020-01-01,2020-12-31&amp;sort=num_votes,desc</p>
<p>If information is missing, selectorgadget result will just skip it, so your rows won’t line up if you are trying to put multiple vectors together.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">scrape_moviedata</span>(<span class="dv">2020</span>)   <span class="co"># uh oh</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="fu">read_html</span>(<span class="st">"https://www.imdb.com/search/title?year=2020&amp;title_type=feature&amp;sort=boxoffice_gross_us,desc"</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="st">".dli-title-metadata-item:nth-child(3)"</span>) <span class="sc">|&gt;</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="exercises" class="level3">
<h3 class="anchored" data-anchor-id="exercises">Exercises</h3>
<ol type="1">
<li>Use the <code>rvest</code> package and <code>html_table</code> to read in the table of data found at the link <a href="https://en.wikipedia.org/wiki/List_of_United_States_cities_by_population">here</a> and create a scatterplot of land area versus the 2022 estimated population. I give you some starter code below; fill in the “???” and be sure you can explain what EVERY line of code does and why it’s necessary.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>city_pop <span class="ot">&lt;-</span> <span class="fu">read_html</span>(<span class="st">"https://en.wikipedia.org/wiki/List_of_United_States_cities_by_population"</span>)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>pop <span class="ot">&lt;-</span> <span class="fu">html_nodes</span>(???)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>pop2 <span class="ot">&lt;-</span> <span class="fu">html_table</span>(pop, <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">fill =</span> <span class="cn">TRUE</span>)[[???]]</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>pop3 <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(pop2[,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>,<span class="dv">8</span>)]) <span class="sc">|&gt;</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>  ???? <span class="sc">|&gt;</span>    <span class="co"># removes first row</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">`</span><span class="at">State</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">ST</span><span class="st">`</span>,</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Estimate2022</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">2022estimate</span><span class="st">`</span>,</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Census</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">2020census</span><span class="st">`</span>,</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Area</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">2020 land area</span><span class="st">`</span>,</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Density</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">2020 density</span><span class="st">`</span>) <span class="sc">|&gt;</span></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Estimate2022 =</span> <span class="fu">parse_number</span>(Estimate2022),</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">Census =</span> <span class="fu">parse_number</span>(Census),</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">Change =</span> ????,   <span class="co"># need to strip off % but not - sign</span></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>                          <span class="co"># Hint: ifelse()</span></span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">Area =</span> <span class="fu">parse_number</span>(Area),</span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">Density =</span> <span class="fu">parse_number</span>(Density)) <span class="sc">|&gt;</span> </span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">City =</span> <span class="fu">str_replace</span>(City, <span class="st">"???"</span>, <span class="st">""</span>))</span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>pop3</span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify unusual cities you'd like to label</span></span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>outliers <span class="ot">&lt;-</span> pop3 <span class="sc">|&gt;</span>   </span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Estimate2022 <span class="sc">&gt;</span> ???? <span class="sc">|</span> Area <span class="sc">&gt;</span> ????)</span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(???) <span class="sc">+</span></span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()  <span class="sc">+</span></span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_label_repel</span>(<span class="at">data =</span> outliers, <span class="fu">aes</span>(<span class="at">label =</span> City))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Use SelectorGadget and the <code>rvest</code> package to pull off data from the top 50 grossing films from 2018. Generate a tibble that contains the title, running time, star rating, and metascore for the top 50 films. You’ll have to clean your tibble so that columns are tidy and plot-worthy, titles include no extra characters, running time is in minutes, etc.</li>
</ol>
<p>Create a scatterplot of star rating versus metascore. Identify movies that had big discrepancies between reviewers (metascore) and viewers (star rating).</p>
<p>For “bonus points”: do longer movies tend to have higher ratings? Answer with an appropriate plot.</p>
<ol start="3" type="1">
<li>Use the <code>httr</code> package to build a data set from the omdb API with a different set of movies and a different set of variables than we used earlier. If you’re feeling ambitious, tidy up the resulting data set.</li>
</ol>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">© Paul Roback, 2024<br> All content licensed under <img src="https://static.thenounproject.com/png/70967-200.png" height="20"> (<a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a>)</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">Site built with <a href="https://quarto.org/">Quarto</a></div>
  </div>
</footer>



</body></html>